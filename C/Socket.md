# Socket

## TCP和UDP的区别

1. TCP提供面向连接的传输，通信前需要经历三次握手；UDP提供无连接的传输，通信前不需要建立连接
2. TCP提供可靠连接，数据传输有序，无差错，不丢失，不重复；UDP提供不可靠连接
3. TCP提供面向字节流的传输，可以将数据分组传输，然后再重组；UDP是面向数据报传输，没有分组开销
4. TCP提供拥塞控制和流量控制机制；UDP不提供拥塞控制和流量控制机制

## 流量控制和拥塞控制

- TCP采用可变大小的滑动窗口机制实现流量控制功能。接收方在返回的数据中会包含自己的接收窗口的大小，以控制发送方的数据发送
- 拥塞控制是作用于网络的，它是防止过多的数据注入到网络中，避免出现网络负载过大的情况。解决方法有慢开始、拥塞避免和快重传、快恢复

## 重传机制

- TCP每发一个报文段，就设置一个定时器。只要在定时器时间之内尚未收到回复确认，就要重发此段报文
- 局域网内延迟一般很小，而互联网之间会较大
- TCP采用一种自适应算法，可以记录每次发送到收到确认的时间差，然后进行加权平均即为平均往返延迟时间

## 信号与信号量

- 信号：是一种处理异步时间的方式。信号是比较复杂的通讯方式，用于接收进程有某种事发生，除了用于进程外，还可以用于进程本身
- 信号量：进程间通讯处理同步互斥的机制。是在多线程环境下使用的一种设施，它负责调度协调各线程能有序合理的使用公共资源

## TCP三次握手

- C -> S : SYN = 1, seq = X
- S -> C : SYN = 1, ACK = 1, seq = Y, ack = X + 1
- C -> S : ACK = 1, seq = X + 1, ack = Y + 1

- C向S请求连接，将SYN置为1，并发送序列号为X的数据包
- S回复C的请求，将SYN置为1，并发送序列号为Y的数据包和确认号X + 1以确认收到序列为X的数据包，表示S能收到C发送的信息
- C回复S的信息，发送序列号为X + 1的数据报和确认号Y + 1以确认收到序列为Y的数据包，表示C能收到S发送的信息
- 连接建立

## TCP四次挥手

- C -> S : FIN = 1, seq = X
- S -> C : ACK = 1, seq = Y, ack = X + 1
- S -> C : FIN = 1, ACK = 1, seq = Y + 1, ack = X + 1
- C -> S : ACK = 1, seq = X + 1, ack = Y + 2

- C向S请求断开，将FIN置为1，并发送序列号为X的数据包
- S回复C的请求，发送序列号为Y，确认号为X + 1的数据包，以确认收到序列号为X的数据包，等待数据传输完毕
- S回复C，将FIN置为1，发送序列号为Y + 1，确认号为X + 1的数据包，以确认数据传输完毕
- C回复S，发送序列号为X + 1,确认号Y + 2的数据包，以确认收到序列为Y + 1的数据包
- 连接断开

## epoll和select的区别

- epoll采用事件驱动，直接通知哪一路I/O被激活。select被通知有I/O激活，必须采用遍历才能知道哪一路被激活
- epoll不限制链接数量。select限制连接数量64位机限制为2048
- epoll仅在linux下可以使用。select跨平台
