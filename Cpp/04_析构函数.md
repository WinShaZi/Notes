# 析构函数

## 析构顺序

``` cpp
// 如继承于基类，析构函数必须先析构派生类再析构基类
class A
{
public:
    virtual ~A()
    {
        std::cout << "~A()" << std::endl;
    }
};

class B : public A
{
public:
    virtual ~B()
    {
        std::cout << "~B()" << std::endl;
    }
};

int main(int argc, char const *argv[])
{
    {
        A a;
    }
    /**
     * => ~A()
    **/
    {
        B b;
    }
    /**
     * => ~B()
     * => ~A()
    **/

    system("pause");
    return 0;
}
```

## 虚析构函数

``` cpp
// 析构函数最好是虚函数，当一个基类指针指向派生类时，若不为虚函数，则只会调用基类析构函数，而不会调用派生类析构函数
class A
{
public:
    virtual ~A()
    {
        std::cout << "~A()" << std::endl;
    }
};

class B : public A
{
public:
    virtual ~B()
    {
        std::cout << "~B()" << std::endl;
    }
};

int main(int argc, char const *argv[])
{
    {
        // 若不为析构函数
        A *pa = dynamic_cast<A *>(new B());
        delete pa;
        pa = nullptr;
    }
    /**
     * => ~A()
    **/
    {
        // 若为析构函数
        A *pa = dynamic_cast<A *>(new B());
        delete pa;
        pa = nullptr;
    }
    /**
     * => ~B()
     * => ~A()
    **/

    system("pause");
    return 0;
}
```
